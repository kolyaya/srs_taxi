\paragraph{Сервис фильтрации} \mbox{} \\ \label{driver_filters_taxi_service}

      \subparagraph{Входные данные} \mbox{} \\ \label{driver_filters_taxi_service_input_data}

        \begin{itemize}

          \item{

            TITLE: Входные данные.\\
            \sr{В качестве входных данных сервис принимает данные перечисленные в списке ниже.}\\
            PRIOR: MODERATE\\

          }

          \begin{itemize}
            \item Заказ (CRDT-\ref{crdt_order})
            \item Радиус (CRDT-\ref{crdt_radius})
          \end{itemize}

        \end{itemize}

      \subparagraph{Выходные данные} \mbox{} \\

        \begin{itemize}

          \item{

            TITLE: Выходные данные.\\
            \sr{В качестве выходных данных сервис возвращает список водителей (CRDT-\ref{crdt_drivers_list}).}\\
            PRIOR: MODERATE\\

          }

        \end{itemize}

      \subparagraph{Процесс фильтрации} \mbox{} \\

        \begin{itemize}

          \item {
            TITLE: Начало и процесс выполнения фильтрации.\\
            \sr{Фильтры расположены в порядке убывания значимости, соответственно выполняются они в том порядке в котором они описаны в таблице \ref{filters_table}.}\\
            PRIOR: MODERATE\\
          }


          \item {
            TITLE: Конец фильтрации.\\
            \sr{Процесс фильтрации заканчивается после выполнения последнего фильтра.}\\
            PRIOR: MODERATE\\
          }

          \item {
            TITLE: Входные/Выходные данные фильтров.\\
            \sr{На выходных данных каждого фильтра мы получаем список водителей.}\\
            \sr{На входных данных каждого фильтра мы получаем [Cписок водителей] + [Данные о заказе - \ref{driver_filters_taxi_service_input_data}].}\\
            \sr{[Cписок водителей] фильтр получает от фильтра выполненного ранее. FLT-\ref{flt_free_drivers} исключение и принимает на вход только [Данные о заказе - \ref{driver_filters_taxi_service_input_data}].}
            PRIOR: MODERATE\\
          }

        \end{itemize}
          

        
          
        
        \label{filters_table}
        \setlength{\extrarowheight}{2mm}
        \begin{longtable}{|p{2cm}|p{3cm}|p{10cm}|}


        \hline  \textbf{ID}  & \textbf{Название фильтра} & \textbf{Требования} \\ [2mm]
        \endfirsthead
        \hline  \textbf{ID}  & \textbf{Название фильтра} & \textbf{Требования} \\ [2mm]
        \endhead



        \hline  \flt{flt_free_drivers}{}  & Фильтр доступных водителей. & \sr{Сервис выбирает из базы данных Службы Такси водителей со статусом "В сети".} \\ [2mm]

        \hline  \flt{flt_diver_user_settings}{}  & Фильтр по пользовательским настройкам водителя. & 

          \sr{Сервер проверяет заказ на совместимость с пользовательскими настройками водителя. (Описание настроек в разделе \ref{server_driver_user_settings}) В этом случае сервер выбирает только тех водителей, чьи настройки совместимы с типом и параметрами заказа.}

          \\ [2mm]

        \hline  \flt{}{}  & Фильтр по классу заказа. & 

          \sr{Сервер проверяет водителей на соответствие класса их ТС с заказом. Выбирает водителей чьи транспортные средства соответствуют классу заказа.}

          \sr{Водитель может брать заказ классом ниже чем ТС водителя, если он установил соответствующие настройки. В этом случае водитель проходит проверку. (Описание настроек в разделе \ref{server_driver_user_settings})}

          \\ [2mm]

        \hline  \flt{}{}  & Фильтр по доп.опциям. & 

         \sr{Сервер проверяет ТС водителей на соответствие параметров с доп. опциями заказа. Выбирает только тех водителей чьи ТС соответствуют доп. опциям заказа.}

          \\ [2mm]

        \hline  \flt{}{}  & Фильтр по расстоянию. & 

          \sr{Сервер выбирает водителей чьи координаты находятся в пределах радиуса [radius] км. от начальной точки заказа.}

          \\ [2mm]

        \hline  \flt{}{}  & Фильтр по времени. & 

          \sr{Сервер выбирает водителей которые свободны во время подачи заказа.}

          \sr{Для каждого из этих водителей сервер с помощью Яндекс.Пробок вычисляет расчетное время подачи машины.}
            \begin{itemize}
              \item В случае если у водителя статус "Свободен", то мы вычисляем РВП от текущей координаты водителя до начальной точки заказа.
              \item Если водитель “Свободен” но у него есть предварительный заказ, то сервер выполняет FLT-\ref{flt_extra_filter}.
              \item В случае если у водителя есть активный заказа и включен робот с настройкой "цепочка", то мы вычисляем РВП от последней (“ближайшей” к времени подачи) записанной в расписании координаты до начальной точки заказа.
              \item Ко всем вышеперечисленным пунктам добавляется “Страховочное время”.
            \end{itemize}

          \sr{Водители, у которых расчетное время подачи машины превышает время, оставшееся до заявленного клиентом, исключаются из дальнейшего рассмотрения.}

          \\ [2mm]

        \hline  \flt{flt_extra_filter}{} (Extra) & Фильтр по РВП для предварительного заказа. (Опционально) &  

          \sr{Если водитель “Свободен” но у него есть предварительный заказ, то сервер выполняет действия описанные в списке ниже.}

            \begin{itemize}
              \item Вычисляем время выполнение поступившего заказа.
              \item Вычисляем время между заказами (предварительный и поступивший) - [a]
                \begin{itemize}
                  \item Если значение отрицательное, то водитель не проходит фильтр.
                \end{itemize}
              \item Затем вычисляем РВП от конечной точки поступившего заказа до начальной точки предварительного заказа - [b]
              \item Сравниваем [a] и [b]:
                \begin{itemize}
                  \item Если [a] > [b], то водитель проходит фильтрацию.
                  \item Если [a] <= [b], то водитель не проходит фильтрацию.
                \end{itemize}
            \end{itemize}

          \sr{Из дальнейшего рассмотрения исключаются водители которые не прошли фильтр FLT-\ref{flt_extra_filter}.}

          \\ [2mm]

        \hline

        \caption {Фильтры}
        \end{longtable}